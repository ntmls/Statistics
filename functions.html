<html>
    <head>
        <title>functions</title>
        <script>
            
            var draw = function() {
                var canvas = document.getElementById("graph");
                var functionSelection = document.getElementById("functionSelection");
                var context = canvas.getContext("2d");
                context.fillRect(0, 0, canvas.clientWidth, canvas.clientHeight);
                context.strokeStyle = "#FFFFFF"; 
                context.strokeWidth = 2;
                switch (functionSelection.value) {
                        
                    case "normal":
                        var fs = []; 
                        fs[0] = normal(0, 2); 
                        fs[1] = normal(2, 2); 
                        fs[2] = normal(1, 1);
                        var xs = createRange(-10, 10, 100); 
                        var ys = createMultipleSeries(fs, xs);
                        plotMany(context, canvas, ys); 
                        break;
                        
                    case "poisson":
                        var fs = []; 
                        fs[0] = poisson(1); 
                        fs[1] = poisson(4);
                        fs[2] = poisson(10);
                        var xs = createRange(0, 20, 21); 
                        xs = xs.map(function(x) { return Math.round(x); });
                        var ys = createMultipleSeries(fs, xs);
                        plotMany(context, canvas, ys); 
                        break;
                        
                    case "sigmoid":
                        var fs = [];
                        fs[0] = sigmoid;
                        var xs = createRange(-10, 10, 100);
                        var ys = createMultipleSeries(fs, xs);
                        plotMany(context, canvas, ys);                         
                        break;
                    
                    case "binomial":
                        var fs = []; 
                        fs[0] = binomial(20, .5); 
                        fs[1] = binomial(10, .5);
                        fs[2] = binomial(10, .25);
                        var xs = createRange(0, 20, 21); 
                        xs = xs.map(function(x) { return Math.round(x); });
                        var ys = createMultipleSeries(fs, xs);
                        plotMany(context, canvas, ys); 
                        break;
                        
                    case "exponential":
                        var fs = [];
                        fs[0] = exponential(1.5); 
                        fs[1] = exponential(1.0); 
                        fs[2] = exponential(.5); 
                        var xs = createRange(0, 10, 100);
                        var ys = createMultipleSeries(fs, xs);
                        plotMany(context, canvas, ys);                         
                        break;
                    
                }
            };
            
            var createMultipleSeries = function(fs, xs) {
                return fs.map(function(f) { return xs.map(f); } );  
            };
            
            var createRange = function(min, max, n) {
                var delta = max - min; 
                var xs = [];
                var inc = delta / n;
                for(var i = 0; i < n; i++) {
                    xs[i] = min + i * inc;
                }
                return xs;
            };
            
            var plot = function(context, canvas, ys, miny, maxy) { 
                var x1 = canvas.clientLeft;
                var y1 = 50;
                if (miny == undefined) { miny = ys.reduce(min2); }
                if (maxy == undefined) { maxy = ys.reduce(max2); }
                var xinc = canvas.clientWidth / (ys.length - 1);
                context.beginPath(); 
                context.moveTo(x1, y1);
                
                for(var i = 0; i < ys.length; i++) {
                    var x2 = i * xinc; 
                    var y2 = scaley(10, canvas.clientHeight - 10, miny, maxy, ys[i]);
                    context.lineTo(x2,y2);
                    var x1 = x2;
                }
                context.stroke();
            }; 
            
            var plotMany = function(context, canvas, series) {
                var ys = flatten(series);
                var miny = ys.reduce(min2); 
                var maxy = ys.reduce(max2);  
                var f = function(s) {
                    plot(context, canvas, s, miny, maxy);  
                };
                series.forEach(f); 
            }; 
            
            var min2 = (a, b) => { return Math.min(a,b); };
            var max2 = (a, b) => { return Math.max(a,b); };
            
            var flatten = function(ar) {
                return ar.reduce(function(a,b) { return a.concat(b); });
            };
            
            var scaley = function(top, bottom, miny, maxy, y) {
                var height = bottom - top;
                var range = maxy - miny;
                var ratio = height / range;
                return bottom - ((y - miny) * ratio);
        
            }; 
            
            var normal = function(mean, stdev)
            {
                var a = 1 / (stdev * Math.sqrt(2.0 * Math.PI));
                var b = (2 * stdev) * (2 * stdev);
                return function(x) {
                    return a * Math.exp(-(((x - mean) * (x - mean))/b)); 
                }
            };
            
            // lambda = average number of events per interval
            // count = number events that actually occurred for this interval
            var poisson = function(lambda) {
                return function(count) {
                    var numer = Math.pow(lambda, count) * Math.pow(Math.E, -lambda); 
                    var denom = factorial(count); 
                    if (denom == 0) { 
                        return 0; 
                    } else {
                        return numer / denom;     
                    }
                };
            };
                        
            var sigmoid = function(x) {
                return x / (Math.sqrt(1+x*x));
            };
            
            // n = number of trials
            // p = probability of succuss for each trial
            var binomial = function(n, p) {
                return function(k) {
                    return choose(n,k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
                };  
            };
            
            var exponential = function(lambda) {
                return function(x) {
                    if(x < 0) { return 0}; 
                    return lambda * Math.pow(Math.E, -lambda * x); 
                };
            };
                
            var factorial = function(n) {
                if (n == 0) { return 1.0; }
                var result = n;
                for(var i = 1; i < n; i++) {
                    result = result * (n - i);
                }
                return result;
            };
            
            // n choose k
            var choose = function(n, k) {
                return factorial(n) / (factorial(k) * factorial(n - k));
            };
            
        </script>
    </head>
    <body onload="draw()">
        <select id="functionSelection" onchange="draw()">
            <option value="normal">Normal</option>
            <option value="poisson">Poisson</option>
            <option value="sigmoid">Sigmoid</option>    
            <option value="binomial">Binomial</option>
            <option value="exponential">Exponential</option>
        </select>
        <br>
        <canvas id="graph" width="320" height = "240"></canvas>
    </body>
</html>